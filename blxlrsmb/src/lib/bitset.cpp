//File: bitset.cpp
//Date: Thu Mar 27 20:47:39 2014 +0800
//Author: Yuxin Wu <ppwwyyxxc@gmail.com>

#include "bitset.h"
#include "common.h"

__m128i lut[] __attribute__((aligned(16))) = {
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000001),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000002),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000004),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000008),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000010),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000020),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000040),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000080),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000100),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000200),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000400),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00000800),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00001000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00002000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00004000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00008000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00010000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00020000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00040000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00080000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00100000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00200000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00400000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x00800000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x01000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x02000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x04000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x08000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x10000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x20000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x40000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000000, 0x80000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000001, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000002, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000004, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000008, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000010, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000020, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000040, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000080, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000100, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000200, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000400, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00000800, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00001000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00002000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00004000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00008000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00010000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00020000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00040000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00080000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00100000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00200000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00400000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x00800000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x01000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x02000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x04000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x08000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x10000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x20000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x40000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000000, 0x80000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000001, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000002, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000004, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000008, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000010, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000020, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000040, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000080, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000100, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000200, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000400, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00000800, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00001000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00002000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00004000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00008000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00010000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00020000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00040000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00080000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00100000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00200000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00400000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x00800000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x01000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x02000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x04000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x08000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x10000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x20000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x40000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000000, 0x80000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000001, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000002, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000004, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000008, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000010, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000020, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000040, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000080, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000100, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000200, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000400, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00000800, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00001000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00002000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00004000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00008000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00010000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00020000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00040000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00080000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00100000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00200000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00400000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x00800000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x01000000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x02000000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x04000000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x08000000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x10000000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x20000000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x40000000, 0x00000000, 0x00000000, 0x00000000),
	_mm_set_epi32(0x80000000, 0x00000000, 0x00000000, 0x00000000)
};

uint8_t POPCOUNT_4bit[16] __attribute__((aligned(16))) = {
	/* 0 */ 0,
	/* 1 */ 1,
	/* 2 */ 1,
	/* 3 */ 2,
	/* 4 */ 1,
	/* 5 */ 2,
	/* 6 */ 2,
	/* 7 */ 3,
	/* 8 */ 1,
	/* 9 */ 2,
	/* a */ 2,
	/* b */ 3,
	/* c */ 2,
	/* d */ 3,
	/* e */ 3,
	/* f */ 4
};

/*
 *int main() {
 *    int n = 10001;
 *    int len = get_len_from_bit(n);
 *    PP(len);
 *    Bitset b(len);
 *    REP(i, 100) b.set(i);
 *    b.set(10000);
 *
 *    Bitset c(len);
 *    REPL(i, 300, 400) c.set(i);
 *    c.set(10000);
 *
 *    b.or_arr(c, len);
 *    PP(b.count(len));
 *}
 */
